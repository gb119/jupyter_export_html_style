{%- extends 'lab/index.html.j2' -%}

{#
  Main entry point for the styled HTML export.
  This extends the lab index template and adds custom style injection.
#}

{% block html_head_css %}
{{ super() }}
{#- Inject custom cell styles if present -#}
{%- if resources.styles -%}
<style>
/* Custom cell styles */
{%- for cell_id, style in resources.styles.items() %}
  {%- if style is mapping -%}
    {%- set style_str = [] -%}
    {%- for k, v in style.items() -%}
      {%- set _ = style_str.append(k ~ ': ' ~ v) -%}
    {%- endfor -%}
#{{ cell_id }} { {{ style_str | join('; ') }} }
  {%- elif style is string -%}
#{{ cell_id }} { {{ style }} }
  {%- endif -%}
{%- endfor -%}
</style>
{%- endif -%}

{#- Inject notebook-level styles if present -#}
{%- if resources.notebook_styles -%}
  {%- if resources.notebook_styles.stylesheet -%}
    {%- if resources.notebook_styles.stylesheet is string -%}
<link rel="stylesheet" href="{{ resources.notebook_styles.stylesheet }}">
    {%- elif resources.notebook_styles.stylesheet is iterable -%}
      {%- for ss in resources.notebook_styles.stylesheet -%}
<link rel="stylesheet" href="{{ ss }}">
      {%- endfor -%}
    {%- endif -%}
  {%- endif -%}
  {%- if resources.notebook_styles.style -%}
<style>
/* Custom notebook styles */
{{ resources.notebook_styles.style }}
</style>
  {%- endif -%}
{%- endif -%}
{% endblock html_head_css %}
